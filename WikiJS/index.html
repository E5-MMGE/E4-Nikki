<br>
<p align="center">
  </p><h2 align="center">Mise en place d'un WikiJS (Debian 11)</h2>
  <p align="center">
    Fait en entreprise et dans le cadre de l'épreuve E4 du BTS SIO 2022-2024
    <br>
    <br>
  </p>
<p></p>

<p><a href="https://8e-couche.ovh/Portfolio/WikiJS/Img/.pdf">Télécharger en PDF</a></p>
<h2 id="sommaire">Sommaire</h2>
<ul>
<li><a href="#Pour-Commencer">Pour Commencer</a><ul>
<li><a href="#Pr%C3%A9requis">Prérequis</a><ul>
<li><a href="#Installation-PostgreSQL">Installation PostgreSQL</a></li>
<li><a href="#Installation-NodeJS">Installation NodeJS 20 (via NVM)</a></li>
</ul>
</li>
<li><a href="#Installation-WikiJS">Installation WikiJS</a><ul>
<li><a href="#Mise-en-place-du-sous-domaine">Mise en place du sous-domaine</a></li>
<li><a href="#Configuration-systemctl">Configuration systemctl</a></li>
<li><a href="#Configuration-de-WikiJS">Configuration de WikiJS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Utilisation">Utilisation</a></li>
</ul>
<h2 id="pour-commencer">Pour Commencer</h2>
<p>Nous avons dans l'entreprise KNCO, eu beaucoup de problèmes récurents et plusieurs situations dont les actions à effectués étaient toujours les mêmes.
<br>Le besoin d'une documentation claire et accessible par l'équipe informatique était nécessaire. Cependant les documentations étaient obsolètes et disponible sur des fichiers en local, innaccessible sans les partager à chaque fois.
<br>Le besoin est donc de pouvoir éditer les documentations facilement pour les mettre à jour, d'avoir un accès simple dans l'idéal en temps réel ou sur un stockage partagé.
<br>Le choix s'est porté en premier lieu sur des documentations en format MD (Markdown) sur un github privé, mais le besoin de visualisation en temps réel des documentations lors de l'édition nous a mené sur la piste d'un WikiJS.
<br>Nous partons du postulat que le service informatique est sur un même réseau, que ce soit en local ou en VPN, celui-ci étant déjà configuré par une autre entreprise.</p>
<p><br>Nous le ferons à l’aide d’un serveur sous Debian 11 déjà installé, et d'un nom de domaine disponible pour la configuration de WikiJS.</p>
<h3 id="prérequis">Prérequis</h3>
<ul>
<li>Serveur Debian 11 pré-installé avec minimum 1Go de RAM et 2 coeurs CPU</li>
<li>Un compte utilisateur sur le serveur avec les droits sudo (ici nommé "wiki")</li>
<li>Un compte Cloudflare</li>
<li>Nom de domaine configurable sur Cloudflare</li>
</ul>
<h4 id="installation-postgresql">Installation PostgreSQL</h4>
<p>WikiJS nécessite une base de données PostgreSQL pour fonctionner, nous allons donc l'installer.</p>
<ol>
<li>Ajout du dépôt PostgreSQL</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--comment syntax--block"># Création du fichier de la configuration du repo</span></span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> sh <span class="syntax--entity syntax--other syntax--attribute-name">-c</span> <span class="syntax--string">'echo "deb https://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" &gt; /etc/apt/sources.list.d/pgdg.list'</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--comment syntax--block"># Import de la clé de signature du repo</span></span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">wget</span> <span class="syntax--entity syntax--other syntax--attribute-name">--quiet</span> <span class="syntax--entity syntax--other syntax--attribute-name">-O</span> <span class="syntax--entity syntax--other syntax--attribute-name">-</span> https://www.postgresql.org/media/keys/ACCC4CF8.asc <span class="syntax--keyword syntax--operator">|</span> <span class="syntax--entity syntax--name syntax--function">sudo</span> apt-key add <span class="syntax--entity syntax--other syntax--attribute-name">-</span></span></div></pre>
<p><br><img title="PostgreSQL Repo" alt="PostgreSQL Repo" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Postgre-1.png?raw=true"></p>
<ol start="2">
<li>Installation de PostgreSQL</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> apt update <span class="syntax--keyword syntax--operator">&amp;&amp;</span> <span class="syntax--entity syntax--name syntax--function">sudo</span> apt <span class="syntax--entity syntax--other syntax--attribute-name">-y</span> install postgresql</span></div></pre>
<p><br><img title="PostgreSQL Installation" alt="PostgreSQL Installation" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Postgre-2.png?raw=true"></p>
<ol start="3">
<li>On entre dans PostgreSQL pour créer la base de données</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> <span class="syntax--entity syntax--other syntax--attribute-name">-u</span> postgres psql</span></div></pre>
<ol start="4">
<li>Création de la base de données et de l'utilisateur "wiki"</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">CREATE</span> DATABASE wiki;</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">CREATE</span> USER wiki WITH ENCRYPTED PASSWORD <span class="syntax--string">'motdepasse'</span>;</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">GRANT</span> ALL PRIVILEGES ON DATABASE wiki TO wiki;</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">ALTER</span> DATABASE wiki OWNER TO wiki;</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">\q</span></span></div></pre>
<p><br><img title="PostgreSQL Database" alt="PostgreSQL Database" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Postgre-3.png?raw=true"></p>
<h4 id="installation-nodejs">Installation NodeJS</h4>
<p>WikiJS nécessite NodeJS pour fonctionner, nous allons donc l'installer via NVM.</p>
<ol>
<li>Installation de NVM</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--comment syntax--block"># Ajout du packet curl si non installé</span></span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> apt install curl <span class="syntax--entity syntax--other syntax--attribute-name">-y</span></span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">curl</span> https://raw.githubusercontent.com/creationix/nvm/master/install.sh <span class="syntax--keyword syntax--operator">|</span> <span class="syntax--entity syntax--name syntax--function">bash</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--comment syntax--block"># Recharger le fichier de configurationa bashrc</span></span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">source</span> ~/.bashrc</span></div></pre>
<p><br><img title="NVM Installation" alt="NVM Installation" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Node-1.png?raw=true"></p>
<ol start="2">
<li>Installation de NodeJS 20</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">nvm</span> install 20</span></div></pre>
<p><br><img title="NodeJS Installation" alt="NodeJS Installation" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Node-2.png?raw=true"></p>
<ol start="3">
<li>Autoriser node à utiliser le port 80</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> apt-get install libcap2-bin</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> setcap cap_net_bind_service=+ep /home/wiki/.nvm/versions/node/v20.12.2/bin/node</span></div></pre>
<p><br><img title="NodeJS Port" alt="NodeJS Port" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Node-3.png?raw=true"></p>
<h3 id="installation-wikijs">Installation WikiJS</h3>
<ol>
<li>Installation de WikiJS</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">wget</span> https://github.com/Requarks/wiki/releases/latest/download/wiki-js.tar.gz</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> mkdir /var/wiki</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> chown <span class="syntax--entity syntax--other syntax--attribute-name">-R</span> <span class="syntax--punctuation syntax--section syntax--embedded">$</span><span class="syntax--variable syntax--other syntax--member">USER</span>:<span class="syntax--punctuation syntax--section syntax--embedded">$</span><span class="syntax--variable syntax--other syntax--member">USER</span> /var/wiki</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> chmod <span class="syntax--entity syntax--other syntax--attribute-name">-R</span> 755 /var/wiki</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">tar</span> xzf wiki-js.tar.gz <span class="syntax--entity syntax--other syntax--attribute-name">-C</span> /var/wiki</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function"><span class="syntax--support syntax--function">cd</span></span> /var/wiki</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">mv</span> config.sample.yml config.yml</span></div></pre>
<p>Les commandes vont ici télécharger la dernière version de WikiJS, créer un dossier pour l'installation, décompresser l'archive et renommer le fichier de configuration par défaut.</p>
<p><br><img title="WikiJS Installation" alt="WikiJS Installation" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-1.png?raw=true"></p>
<ol start="2">
<li>Edition du fichier de configuration</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">nano</span> config.yml</span></div></pre>
<p>Nous allons modifier les informations du port d'écoute et de la base de données.</p>
<p><br><img title="WikiJS Configuration" alt="WikiJS Configuration" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-2.png?raw=true"></p>
<ol start="3">
<li>Installation des dépendances</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">npm</span> rebuild sqlite3</span></div></pre>
<p><br><img title="WikiJS Dependencies" alt="WikiJS Dependencies" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-3.png?raw=true"></p>
<h4 id="mise-en-place-du-sous-domaine">Mise en place du sous-domaine</h4>
<ol>
<li>Configuration du sous-domaine sur Cloudflare</li>
</ol>
<p><br><img title="Cloudflare Subdomain" alt="Cloudflare Subdomain" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-4.png?raw=true"></p>
<h4 id="configuration-systemctl">Configuration systemctl</h4>
<p>Pour simplifier le lancement de WikiJS et l'activer au démarrage, nous allons créer un service systemd.</p>
<ol>
<li>Création du fichier de service</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> nano /etc/systemd/system/wiki.service</span></div></pre>
<ol start="2">
<li>Ajout du contenu suivant (en modifiant les chemins si nécessaire)</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell">[Unit]</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">Description</span>=Wiki.js</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">After</span>=network.target</span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--shell">[Service]</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">Type</span>=simple</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">ExecStart</span>=/home/wiki/.nvm/versions/node/v20.12.2/bin/node <span class="syntax--entity syntax--name syntax--function">server</span></span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">Restart</span>=always</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">User</span>=wiki</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">Environment</span>=NODE_ENV=production</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">WorkingDirectory</span>=/var/wiki</span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--shell">[Install]</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--variable syntax--other syntax--member">WantedBy</span>=multi-user.target</span></div></pre>
<p><br><img title="Systemd Service" alt="Systemd Service" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-5.png?raw=true"></p>
<ol start="3">
<li>Activation et démarrage du service</li>
</ol>
<pre class="editor-colors lang-bash"><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> systemctl enable wiki</span></div><div class="line"><span class="syntax--source syntax--shell"><span class="syntax--entity syntax--name syntax--function">sudo</span> systemctl start wiki</span></div></pre>
<p><br><img title="Systemd Start" alt="Systemd Start" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-6.png?raw=true"></p>
<h4 id="configuration-de-wikijs">Configuration de WikiJS</h4>
<ol>
<li>Accès à l'interface de configuration, disponible à l'adresse <a href="https://SOUS.DOMAINE.WIKIJS/">https://SOUS.DOMAINE.WIKIJS/</a></li>
</ol>
<p><br><img title="WikiJS Configuration" alt="WikiJS Configuration" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-7.png?raw=true"></p>
<ol start="2">
<li>Configuration de l'email administateur et son mot de passe (identifiant à utiliser pour la connexion) ainsi que le nom de domaine.</li>
</ol>
<p><br><img title="WikiJS Admin" alt="WikiJS Admin" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-8.png?raw=true"></p>
<ol start="3">
<li>Une fois l'installation terminée, vous pouvez vous connecter à l'interface d'administration avec l'identifiant et le mot de passe définis.</li>
</ol>
<p><br><img title="WikiJS Admin" alt="WikiJS Admin" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki-9.png?raw=true"></p>
<p>Nous allons maintenant forcer la connexion utilisateur pour visionner les documentations.</p>
<ol start="4">
<li>Aller dans "Administration"</li>
</ol>
<p><br><img title="WikiJS Admin" alt="WikiJS Admin" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki_Admin-1.png?raw=true"></p>
<ol start="5">
<li>Aller dans "Groups"</li>
</ol>
<p><br><img title="WikiJS Admin" alt="WikiJS Admin" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki_Admin-2.png?raw=true"></p>
<ol start="6">
<li>Aller dans "Guest"</li>
</ol>
<p><br><img title="WikiJS Admin" alt="WikiJS Admin" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki_Admin-3.png?raw=true"></p>
<ol start="7">
<li>Aller dans "Permissions"</li>
</ol>
<p><br><img title="WikiJS Admin" alt="WikiJS Admin" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki_Admin-4.png?raw=true"></p>
<ol start="8">
<li>Décocher tout et faites "Update Group"</li>
</ol>
<p><br><img title="WikiJS Admin" alt="WikiJS Admin" src="https://8e-couche.ovh/Portfolio/WikiJS/Img/Wiki_Admin-5.png?raw=true"></p>
<p>Il vous faudra désormais vous connecter pour accéder aux documentations.
Le lien de connexion est <a href="https://SOUS.DOMAINE.WIKIJS/login">https://SOUS.DOMAINE.WIKIJS/login</a> .</p>
<h3 id="utilisation">Utilisation</h3>
<p>Vous pouvez maintenant éditer vos documentations en voyant le résultat en temps réel ainsi que les visionner une fois connecté dessus.
<br>Vous pouvez également ajouter des utilisateurs et des groupes pour gérer les permissions de lecture et d'écriture.
<br>WikiJS est un outil très complet dont les pages sont écrites en Markdown, supporte l'ajout de fichiers et supporte également l'ajout d'addons officiels tel que la solutions d'écriture mathématique LaTeX Math, ce qui permet une grande flexibilité dans l'écriture des documentations dans un nombre de domaines très variés.
<br>Il est également possible de créer une documentation en plusieurs langues avec les options de localisation, ceci necessitant tout de même l'édition des documentations dans chaque langue, ne faisant pas de traduction automatique.</p>
